<script type="module">
        // ... (Importaciones de Firebase iguales) ...

        const firebaseConfig = {
            // TUS CREDENCIALES (Asegúrate de que sigan aquí)
            apiKey: "AIzaSyC-cNJm__gM_e0lijaG7DgYPikXfnuHRZA",
            authDomain: "agendaresiliencia-12.firebaseapp.com",
            projectId: "agendaresiliencia-12",
            storageBucket: "agendaresiliencia-12.firebasestorage.app",
            messagingSenderId: "1068233469888",
            appId: "1:1068233469888:web:f958c72f406ac8698da225"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const ADMIN_EMAIL = "resilienciaguate@gmail.com";
        
        let selectedTimeInfo = null;
        let psicologasCount = 0; // Para llevar la cuenta de los colores

        // PALETA DE COLORES CONTRASTANTES
        const palette = [
            '#e6194b', '#3cb44b', '#4363d8', '#f58231', 
            '#911eb4', '#46f0f0', '#f032e6', '#bcf60c', 
            '#fabebe', '#008080', '#e6beff', '#9a6324'
        ];

        const getNextColor = () => {
            const color = palette[psicologasCount % palette.length];
            psicologasCount++;
            return color;
        };

        // ... (Lógica de Login/Logout igual) ...

        onAuthStateChanged(auth, (user) => {
            if (user) {
                const isAdmin = user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase();
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('nav-bar').style.display = 'flex';
                document.getElementById('app-content').style.display = 'flex';
                
                if(isAdmin) {
                    document.getElementById('admin-panel').style.display = 'block';
                    document.getElementById('user-display').innerText = "ADMINISTRACIÓN";
                    cargarPsicologasAdmin();
                } else {
                    document.getElementById('admin-panel').style.display = 'none';
                    document.getElementById('user-display').innerText = `PSICÓLOGA: ${user.email}`;
                }
                initCalendar(user.email, isAdmin);
            }
        });

        function cargarPsicologasAdmin() {
            onSnapshot(collection(db, "psicologas"), (snap) => {
                const select = document.getElementById('modal-psicologa-select');
                const list = document.getElementById('docs-list');
                select.innerHTML = ""; list.innerHTML = "";
                
                // Reiniciamos el contador para que los colores sean consistentes al cargar
                psicologasCount = 0; 

                snap.forEach(d => {
                    const data = d.data();
                    const id = d.id;
                    
                    // Si la psicóloga ya tiene un color guardado, lo usamos, si no, le damos uno nuevo
                    const userColor = data.color || getNextColor();

                    select.innerHTML += `<option value="${data.email}" data-color="${userColor}">${data.name}</option>`;
                    
                    const div = document.createElement('div');
                    div.className = 'psicologa-item';
                    div.style.background = userColor;
                    div.innerHTML = `<span>${data.name}</span><button class="btn-delete-user" data-id="${id}">✕</button>`;
                    list.appendChild(div);
                    
                    psicologasCount++;
                });
                
                document.querySelectorAll('.btn-delete-user').forEach(btn => {
                    btn.onclick = async (e) => {
                        if(confirm("¿Eliminar?")) await deleteDoc(doc(db, "psicologas", e.target.getAttribute('data-id')));
                    };
                });
            });
        }

        document.getElementById('add-doc-btn').onclick = async () => {
            const email = document.getElementById('new-doc-email').value;
            const name = document.getElementById('new-doc-name').value;
            if(email && name) {
                // Al registrar, le asignamos el siguiente color de la paleta permanentemente
                const assignedColor = palette[psicologasCount % palette.length];
                await addDoc(collection(db, "psicologas"), { 
                    email, 
                    name, 
                    color: assignedColor 
                });
                document.getElementById('new-doc-email').value = "";
                document.getElementById('new-doc-name').value = "";
            }
        };

        // ... (Resto de la función initCalendar y guardarCita se mantienen igual) ...
        // ... (Asegúrate de que la función guardarCita use el color del selector) ...

        async function guardarCita(paciente, email, color) {
            let start = new Date(selectedTimeInfo.start);
            let end = new Date(start.getTime() + (60 * 60 * 1000));
            await addDoc(collection(db, "citas"), { 
                title: paciente, 
                start: start.toISOString(), 
                end: end.toISOString(), 
                user: email, 
                color: color || '#292929' 
            });
            document.getElementById('assign-modal').style.display = 'none';
        }
    </script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
</body>
</html>
