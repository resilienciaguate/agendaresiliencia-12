// ... (resto del código permanece igual)

        document.getElementById('btn-guardar-cita').onclick = async () => {
            const nombre = document.getElementById('px-nombre').value;
            const whatsapp = document.getElementById('px-whatsapp').value;
            if(!nombre) return alert("Falta nombre");
            
            const color = equipoGlobal.find(p => p.email.toLowerCase() === auth.currentUser.email.toLowerCase())?.color || '#a5c941';
            const fechaHora = new Date(tempSelection.startStr).toLocaleString('es-GT', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long', 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            await addDoc(collection(db, "citas"), { 
                title: nombre, 
                tel: whatsapp, 
                start: tempSelection.startStr, 
                end: tempSelection.endStr, 
                user: auth.currentUser.email.toLowerCase(), 
                color: color 
            });

            if(whatsapp) {
                const mensaje = `Hola, ${nombre} tu cita en RESILIENCIA ha sido agendada exitosamente el día ${fechaHora}. Te esperamos!`;
                window.open(`https://wa.me/${whatsapp}?text=${encodeURIComponent(mensaje)}`);
            }
            cerrarModalCita();
        };

// ... (resto del código permanece igual)
